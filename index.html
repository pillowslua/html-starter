<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaiGPT Key System - Bro là ai?</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6a0dad; /* Màu tím huyền ảo của HaiGPT */
            --secondary-color: #00bcd4; /* Màu xanh ngọc bá đạo */
            --text-color: #333;
            --bg-color: #f0f2f5;
            --card-bg: #fff;
            --border-radius: 12px;
            --shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            --transition-speed: 0.5s;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg-color), #e2eafc);
            margin: 0;
            color: var(--text-color);
            overflow: hidden;
            position: relative;
        }

        /* Background Blobs */
        body::before {
            content: '';
            position: absolute;
            top: -50px;
            left: -50px;
            width: 200px;
            height: 200px;
            background: var(--primary-color);
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(80px);
            animation: moveBlob1 15s infinite alternate;
        }

        body::after {
            content: '';
            position: absolute;
            bottom: -50px;
            right: -50px;
            width: 250px;
            height: 250px;
            background: var(--secondary-color);
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(100px);
            animation: moveBlob2 20s infinite alternate;
        }

        @keyframes moveBlob1 {
            0% { transform: translate(0, 0); }
            50% { transform: translate(100px, 150px); }
            100% { transform: translate(0, 0); }
        }

        @keyframes moveBlob2 {
            0% { transform: translate(0, 0); }
            50% { transform: translate(-100px, -150px); }
            100% { transform: translate(0, 0); }
        }

        /* Container và các bước (steps) */
        .container {
            background-color: var(--card-bg);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            width: 90%;
            max-width: 450px;
            animation: fadeIn var(--transition-speed) ease-out;
            z-index: 1; /* Đảm bảo nổi trên các blob */
            position: relative; /* Để các bước con dùng absolute */
            overflow: hidden; /* Che đi phần tràn của animation */
        }

        .step {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 40px; /* Cùng với padding của container */
            box-sizing: border-box;
            opacity: 0;
            transform: translateX(100%); /* Bắt đầu từ phải */
            transition: opacity var(--transition-speed) ease-in-out, transform var(--transition-speed) ease-in-out;
            display: flex; /* Dùng flex để căn giữa nội dung */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%; /* Đảm bảo chiều cao đầy đủ */
        }

        .step.active {
            opacity: 1;
            transform: translateX(0); /* Di chuyển vào giữa */
            position: relative; /* Đặt lại relative khi active */
        }
        
        .step.exit {
            transform: translateX(-100%); /* Di chuyển sang trái khi exit */
            opacity: 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 2.2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }

        input[type="text"] {
            padding: 14px 18px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            width: calc(100% - 36px); /* padding + border */
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-sizing: border-box; /* Tính cả padding và border vào width */
        }

        input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(106, 13, 173, 0.2);
            outline: none;
        }

        button, .discord-button {
            background-color: var(--primary-color);
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            min-width: 120px;
            text-decoration: none; /* For anchor tag */
            display: inline-block; /* For anchor tag */
            text-align: center;
        }

        button:hover:not(:disabled), .discord-button:hover {
            background-color: #5a0bae;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .message { /* Dùng chung cho các thông báo con */
            margin-top: 25px;
            font-weight: bold;
            font-size: 1.1em;
            min-height: 25px; /* Giữ chỗ cho thông báo */
        }
        
        #globalMessage { /* Thông báo chung dưới cùng */
            margin-top: 20px;
            font-size: 0.9em;
            color: #777;
        }

        .success { color: green; }
        .error { color: red; }
        .info { color: var(--secondary-color); }
        .warning { color: orange; }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Popup / Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 30px 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            transform: translateY(-50px);
            transition: transform 0.3s ease-in-out;
            max-width: 400px;
            width: 90%;
        }

        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <!-- Bước 1: Bắt đầu lấy Key -->
        <div id="initialState" class="step">
            <h1>HaiGPT Key System</h1>
            <p class="info">Chào bro, muốn vào thì phải có chìa khóa nha =))</p>
            <button id="startButton">Get Key</button>
            <p id="initialMessage" class="message info">Ấn nút để kích hoạt hệ thống key, nhớ làm theo hướng dẫn nha!</p>
        </div>

        <!-- Bước 2: Captcha -->
        <div id="captchaContainer" class="step">
            <h2>Giải mã Captcha</h2>
            <p id="captchaQuestion"></p>
            <input type="text" id="captchaInput" placeholder="Nhập câu trả lời...">
            <button id="submitCaptchaButton">Xác nhận</button>
            <p id="captchaMessage" class="message info"></p>
        </div>

        <!-- Bước 3: Tham gia Discord (Yêu cầu đợi và "quét") -->
        <div id="discordContainer" class="step">
            <h2>Bước quan trọng!</h2>
            <p class="info">Để nhận key, bro cần tham gia Discord của TuanHaiDz.</p>
            <a href="https://discord.gg/m3EV55SpYw" target="_blank" class="discord-button">
                Tham gia Discord ngay!
            </a>
            <p class="message info" style="margin-top: 20px;">
                <span class="spinner" id="discordCheckSpinner" style="display:none;"></span>
                <span id="discordCheckMessage">Sau khi tham gia, hãy đợi một chút để hệ thống xác nhận...</span>
            </p>
            <button id="confirmDiscordButton" disabled style="margin-top: 20px;">Xác nhận đã tham gia Discord</button>
        </div>

        <!-- Bước 4: Đợi 10 giây tải Key -->
        <div id="waiting10SecContainer" class="step">
            <h2><span class="spinner"></span> Đang tải key và đợi chờ...</h2>
            <p id="wait10SecMessage" class="message warning"></p>
        </div>

        <!-- Bước 5: Hiển thị Popup Đợi thêm 5 giây -->
        <div class="modal-overlay" id="popup5SecModal">
            <div class="modal-content">
                <h2><span class="spinner"></span> Sắp xong rồi bro!</h2>
                <p class="info">Đang hoàn tất bước cuối cùng. Đợi thêm <span id="popupCountdown">5</span> giây nữa thôi!</p>
                <p class="info">HaiGPT đang chuẩn bị chìa khóa cho bro đây =))</p>
            </div>
        </div>

        <!-- Bước 6: Hiển thị Key -->
        <div id="finalKeyContainer" class="step">
            <h2>Key của bro đây nè!</h2>
            <input type="text" id="finalKeyDisplay" readonly>
            <button id="copyKeyButton">Sao chép Key</button>
            <p id="finalKeyMessage" class="message success"></p>
            <p class="warning" style="font-size: 0.9em; margin-top: 15px;">
                LƯU Ý: Đây là hệ thống giả lập. Key được hiển thị chỉ mang tính demo.
            </p>
        </div>

        <p id="globalMessage"></p> <!-- Dùng để hiển thị thông báo chung -->
    </div>

    <script>
        const KEY_SOURCE_URL = "https://raw.githubusercontent.com/pillowslua/kin-hub/refs/heads/main/keys";
        let validKeys = []; // Sẽ chứa các key tải về
        let finalKeyToDisplay = ""; // Key cuối cùng sẽ hiển thị
        let captchaAnswer = 0; // Lưu câu trả lời captcha đúng
        let currentStepElement = null; // Biến để quản lý bước hiện tại
        const container = document.getElementById('mainContainer'); // Lấy container để set height

        // Lấy các element cần dùng
        const initialStateDiv = document.getElementById('initialState');
        const startButton = document.getElementById('startButton');
        const initialMessage = document.getElementById('initialMessage');

        const captchaContainer = document.getElementById('captchaContainer');
        const captchaQuestion = document.getElementById('captchaQuestion');
        const captchaInput = document.getElementById('captchaInput');
        const submitCaptchaButton = document.getElementById('submitCaptchaButton');
        const captchaMessage = document.getElementById('captchaMessage');

        const discordContainer = document.getElementById('discordContainer');
        const discordButton = document.querySelector('.discord-button');
        const discordCheckSpinner = document.getElementById('discordCheckSpinner');
        const discordCheckMessage = document.getElementById('discordCheckMessage');
        const confirmDiscordButton = document.getElementById('confirmDiscordButton');

        const waiting10SecContainer = document.getElementById('waiting10SecContainer');
        const wait10SecMessage = document.getElementById('wait10SecMessage');

        const popup5SecModal = document.getElementById('popup5SecModal');
        const popupCountdown = document.getElementById('popupCountdown');

        const finalKeyContainer = document.getElementById('finalKeyContainer');
        const finalKeyDisplay = document.getElementById('finalKeyDisplay');
        const copyKeyButton = document.getElementById('copyKeyButton');
        const finalKeyMessage = document.getElementById('finalKeyMessage');

        const globalMessage = document.getElementById('globalMessage');

        // Hàm hiển thị/ẩn các bước với animation
        function showStep(stepElement, direction = 'forward') {
            // Xác định chiều cao của bước mới để container thay đổi kích thước mượt mà
            const currentStepHeight = currentStepElement ? currentStepElement.offsetHeight : 0;
            const newStepHeight = stepElement.offsetHeight;
            container.style.height = `${Math.max(currentStepHeight, newStepHeight)}px`;
            container.style.transition = 'height var(--transition-speed) ease-in-out';


            if (currentStepElement) {
                currentStepElement.classList.remove('active');
                currentStepElement.classList.add(direction === 'forward' ? 'exit' : 'enter-reverse'); // Thêm class exit/enter-reverse
                // Chờ animation exit kết thúc rồi mới ẩn hoàn toàn
                setTimeout(() => {
                    currentStepElement.style.display = 'none';
                    if (direction === 'forward') {
                        currentStepElement.classList.remove('exit');
                    } else {
                        currentStepElement.classList.remove('enter-reverse');
                    }
                }, parseFloat(getComputedStyle(currentStepElement).transitionDuration) * 1000);
            }

            stepElement.style.display = 'flex'; // Hiện bước mới
            // Force reflow để đảm bảo transition được áp dụng
            void stepElement.offsetWidth; 
            stepElement.classList.remove('exit', 'enter-reverse'); // Xóa class exit/enter-reverse nếu có
            stepElement.classList.add('active'); // Thêm class active
            currentStepElement = stepElement;
            globalMessage.textContent = ''; // Xóa thông báo chung mỗi khi đổi bước

            // Cập nhật chiều cao container sau khi bước mới active hoàn toàn
            setTimeout(() => {
                container.style.height = `${stepElement.offsetHeight}px`;
            }, parseFloat(getComputedStyle(stepElement).transitionDuration) * 1000);
        }

        // --- Logic cho từng bước ---

        // Bước 1: Bắt đầu lấy Key
        startButton.addEventListener('click', () => {
            showStep(captchaContainer);
            generateCaptcha();
            captchaInput.focus();
            captchaMessage.textContent = 'Tính toán cho kỹ nha bro!';
            captchaMessage.className = 'info';
        });

        // Hàm tạo Captcha đơn giản
        function generateCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1; // Số từ 1 đến 10
            const num2 = Math.floor(Math.random() * 10) + 1;
            captchaAnswer = num1 + num2;
            captchaQuestion.textContent = `HaiGPT đố bro: ${num1} + ${num2} = ?`;
            captchaInput.value = ''; // Xóa input cũ
        }

        // Bước 2: Xử lý Captcha
        submitCaptchaButton.addEventListener('click', () => {
            const userAnswer = parseInt(captchaInput.value.trim());
            if (isNaN(userAnswer) || userAnswer !== captchaAnswer) {
                captchaMessage.textContent = 'Sai rồi bro, tính toán lại coi =))';
                captchaMessage.className = 'error';
                generateCaptcha(); // Tạo captcha mới
            } else {
                captchaMessage.textContent = 'Chính xác! Bro thông minh đó =))';
                captchaMessage.className = 'success';
                setTimeout(() => startDiscordCheck(), 1000); // Đợi 1 giây rồi chuyển bước
            }
        });

        // Bước 3: Tham gia Discord (mô phỏng quét)
        function startDiscordCheck() {
            showStep(discordContainer);
            discordCheckSpinner.style.display = 'none'; // Ẩn spinner ban đầu
            discordCheckMessage.textContent = 'Nhấn nút "Tham gia Discord ngay!" để mở kênh Discord của TuanHaiDz.';
            discordCheckMessage.className = 'info';
            confirmDiscordButton.disabled = true; // Vô hiệu hóa nút xác nhận

            // Khi click nút Discord, bắt đầu "quét" (mô phỏng)
            discordButton.addEventListener('click', () => {
                discordCheckSpinner.style.display = 'inline-block'; // Hiện spinner
                discordCheckMessage.textContent = 'Đang giả lập quét để kiểm tra bro đã tham gia Discord chưa...';
                discordCheckMessage.className = 'warning';
                
                // Mô phỏng quá trình quét/kiểm tra Discord trong 5 giây
                setTimeout(() => {
                    discordCheckSpinner.style.display = 'none'; // Ẩn spinner
                    discordCheckMessage.textContent = 'Giả lập quét hoàn tất! Giờ bro có thể xác nhận đã tham gia.';
                    discordCheckMessage.className = 'success';
                    confirmDiscordButton.disabled = false; // Kích hoạt nút xác nhận
                }, 5000); // Giả lập quét 5 giây
            }, { once: true }); // Chỉ lắng nghe sự kiện click 1 lần
        }

        confirmDiscordButton.addEventListener('click', () => {
            if (!confirmDiscordButton.disabled) { // Chỉ xử lý khi nút đã được kích hoạt
                startWaiting10Sec();
            }
        });

        // Bước 4: Đợi 10 giây và tải Key (song song)
        async function startWaiting10Sec() {
            showStep(waiting10SecContainer);
            let countdown = 10;
            wait10SecMessage.innerHTML = `<span class="spinner"></span> Đang chờ ${countdown} giây thần thánh để tải key từ vũ trụ GitHub...`;
            wait10SecMessage.className = 'warning';

            // Bắt đầu tải key ngay lập tức trong khi chờ
            const fetchPromise = fetchKeys();

            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown >= 0) {
                    wait10SecMessage.innerHTML = `<span class="spinner"></span> Đang chờ ${countdown} giây thần thánh để tải key từ vũ trụ GitHub...`;
                }
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    wait10SecMessage.innerHTML = `<span class="spinner"></span> Đã xong 10 giây! Chuẩn bị chuyển bước...`;
                    fetchPromise.then(() => {
                        setTimeout(() => showPopup5Sec(), 1000); // Đợi thêm 1 giây cho mượt
                    }).catch(error => {
                        globalMessage.textContent = `Ối giời ơi, lỗi khi tải key rồi: ${error.message}. Kêu TuanHaiDz sửa gấp đi!`;
                        globalMessage.className = 'error';
                        showStep(initialStateDiv); // Quay về bước đầu
                        initialMessage.textContent = 'Lỗi tải key! Ấn lại để thử nha bro.';
                        initialMessage.className = 'error';
                    });
                }
            }, 1000);
        }

        async function fetchKeys() {
            try {
                const response = await fetch(KEY_SOURCE_URL);
                if (!response.ok) {
                    throw new Error(`Méo tải được keys: ${response.statusText}`);
                }
                const rawText = await response.text();
                validKeys = rawText.split('\n').map(key => key.trim()).filter(key => key.length > 0);
                if (validKeys.length > 0) {
                    finalKeyToDisplay = validKeys[Math.floor(Math.random() * validKeys.length)]; // Lấy key đầu tiên trong danh sách để hiển thị
                } else {
                    throw new Error("Không có key nào trong file! Check lại file đi bro.");
                }
                console.log("Keys đã tải xong:", validKeys); // Cho bro debug nếu cần
            } catch (error) {
                console.error('Lỗi thần thánh khi tải keys:', error);
                throw error; // Ném lỗi để promise chain bắt được
            }
        }

        // Bước 5: Hiển thị Popup Đợi thêm 5 giây
        function showPopup5Sec() {
            popup5SecModal.classList.add('show');
            let countdown = 5;
            popupCountdown.textContent = countdown;

            const popupInterval = setInterval(() => {
                countdown--;
                popupCountdown.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(popupInterval);
                    popup5SecModal.classList.remove('show');
                    setTimeout(() => showFinalKey(), 500); // Chờ popup đóng rồi hiện key
                }
            }, 1000);
        }

        // Bước 6: Hiển thị Key
        function showFinalKey() {
            showStep(finalKeyContainer);
            if (finalKeyToDisplay) {
                finalKeyDisplay.value = finalKeyToDisplay;
                finalKeyMessage.textContent = 'Đây là key của bro! Sao chép lẹ đi rồi quẩy =))';
                finalKeyMessage.className = 'success';
                finalKeyDisplay.select(); // Tự động chọn text để dễ copy
                finalKeyDisplay.setSelectionRange(0, 99999); // Dành cho di động
            } else {
                globalMessage.textContent = 'Ối, chưa có key để hiển thị! Có lỗi gì đó rồi bro.';
                globalMessage.className = 'error';
                showStep(initialStateDiv); // Quay về bước đầu
            }
        }

        // Hàm copy key vào clipboard
        copyKeyButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(finalKeyDisplay.value);
                finalKeyMessage.textContent = 'Đã sao chép key vào clipboard! Nhanh gọn lẹ =))';
                finalKeyMessage.className = 'success';
            } catch (err) {
                console.error('Lỗi khi sao chép:', err);
                finalKeyMessage.textContent = 'Sao chép thất bại rồi bro ơi! Bro tự copy tay đi =))';
                finalKeyMessage.className = 'error';
            }
        });

        // Khởi tạo trạng thái ban đầu khi load trang
        // Đặt chiều cao ban đầu của container dựa trên bước đầu tiên
        window.addEventListener('load', () => {
            showStep(initialStateDiv);
            container.style.height = `${initialStateDiv.offsetHeight}px`;
        });
    </script>
</body>
</html>
