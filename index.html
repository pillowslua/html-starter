<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HaiGPT Key System - Bro là ai?</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6a0dad; /* Màu tím huyền ảo của HaiGPT */
            --secondary-color: #00bcd4; /* Màu xanh ngọc bá đạo */
            --text-color: #333;
            --bg-color: #f0f2f5;
            --card-bg: #fff;
            --border-radius: 12px;
            --shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Quicksand', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg-color), #e2eafc);
            margin: 0;
            color: var(--text-color);
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: -50px;
            left: -50px;
            width: 200px;
            height: 200px;
            background: var(--primary-color);
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(80px);
            animation: moveBlob1 15s infinite alternate;
        }

        body::after {
            content: '';
            position: absolute;
            bottom: -50px;
            right: -50px;
            width: 250px;
            height: 250px;
            background: var(--secondary-color);
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(100px);
            animation: moveBlob2 20s infinite alternate;
        }

        @keyframes moveBlob1 {
            0% { transform: translate(0, 0); }
            50% { transform: translate(100px, 150px); }
            100% { transform: translate(0, 0); }
        }

        @keyframes moveBlob2 {
            0% { transform: translate(0, 0); }
            50% { transform: translate(-100px, -150px); }
            100% { transform: translate(0, 0); }
        }

        .container {
            background-color: var(--card-bg);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            width: 90%;
            max-width: 450px;
            animation: fadeIn 1s ease-out;
            z-index: 1; /* Đảm bảo nổi trên các blob */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2 {
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 2.2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }

        input[type="text"] {
            padding: 14px 18px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            width: calc(100% - 36px); /* padding + border */
            font-size: 1.1em;
            transition: all 0.3s ease;
            box-sizing: border-box; /* Tính cả padding và border vào width */
        }

        input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(106, 13, 173, 0.2);
            outline: none;
        }

        button, .discord-button {
            background-color: var(--primary-color);
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
            min-width: 120px;
            text-decoration: none; /* For anchor tag */
            display: inline-block; /* For anchor tag */
            text-align: center;
        }

        button:hover:not(:disabled), .discord-button:hover {
            background-color: #5a0bae;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #globalMessage {
            margin-top: 25px;
            font-weight: bold;
            font-size: 1.1em;
            min-height: 25px; /* Giữ chỗ cho thông báo */
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }

        .info {
            color: var(--secondary-color);
        }

        .warning {
            color: orange;
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>HaiGPT Key System</h1>
        <p class="info">Chào bro, muốn vào thì phải có chìa khóa nha =))</p>

        <!-- Bước 1: Bắt đầu lấy Key -->
        <div id="initialState">
            <button id="startButton">Bắt đầu lấy Key</button>
            <p id="stepMessage" class="info">Ấn nút để kích hoạt hệ thống key, nhớ làm theo hướng dẫn nha!</p>
        </div>

        <!-- Bước 2: Captcha -->
        <div id="captchaContainer" style="display: none;">
            <h2>Giải mã Captcha</h2>
            <p id="captchaQuestion"></p>
            <input type="text" id="captchaInput" placeholder="Nhập câu trả lời...">
            <button id="submitCaptchaButton">Xác nhận</button>
            <p id="captchaMessage" class="info"></p>
        </div>

        <!-- Bước 3: Đợi 10 giây -->
        <div id="waitingContainer" style="display: none;">
            <h2><span class="spinner"></span> Đang tải key và đợi chờ...</h2>
            <p id="waitMessage" class="warning"></p>
        </div>

        <!-- Bước 4: Tham gia Discord -->
        <div id="discordContainer" style="display: none;">
            <h2>Bước cuối cùng!</h2>
            <p class="info">Tham gia Discord của TuanHaiDz để nhận key ngay!</p>
            <a href="https://discord.gg/m3EV55SpYw" target="_blank" class="discord-button">
                Tham gia Discord
            </a>
            <button id="getKeyButton" style="margin-top: 20px;">Xác nhận đã tham gia Discord</button>
            <p id="discordMessage" class="info"></p>
        </div>

        <!-- Bước 5: Hiển thị Key -->
        <div id="finalKeyContainer" style="display: none;">
            <h2>Key của bro đây nè!</h2>
            <input type="text" id="finalKeyDisplay" readonly>
            <button id="copyKeyButton">Sao chép Key</button>
            <p id="finalKeyMessage" class="success"></p>
        </div>

        <p id="globalMessage"></p> <!-- Dùng để hiển thị thông báo chung -->
    </div>

    <script>
        const KEY_SOURCE_URL = "https://raw.githubusercontent.com/pillowslua/kin-hub/refs/heads/main/keys";
        let validKeys = []; // Sẽ chứa các key tải về
        let finalKeyToDisplay = ""; // Key cuối cùng sẽ hiển thị
        let captchaAnswer = 0; // Lưu câu trả lời captcha đúng

        // Lấy các element cần dùng
        const initialStateDiv = document.getElementById('initialState');
        const startButton = document.getElementById('startButton');
        const stepMessage = document.getElementById('stepMessage');

        const captchaContainer = document.getElementById('captchaContainer');
        const captchaQuestion = document.getElementById('captchaQuestion');
        const captchaInput = document.getElementById('captchaInput');
        const submitCaptchaButton = document.getElementById('submitCaptchaButton');
        const captchaMessage = document.getElementById('captchaMessage');

        const waitingContainer = document.getElementById('waitingContainer');
        const waitMessage = document.getElementById('waitMessage');

        const discordContainer = document.getElementById('discordContainer');
        const discordButton = document.querySelector('.discord-button');
        const getKeyButton = document.getElementById('getKeyButton');
        const discordMessage = document.getElementById('discordMessage');

        const finalKeyContainer = document.getElementById('finalKeyContainer');
        const finalKeyDisplay = document.getElementById('finalKeyDisplay');
        const copyKeyButton = document.getElementById('copyKeyButton');
        const finalKeyMessage = document.getElementById('finalKeyMessage');

        const globalMessage = document.getElementById('globalMessage');

        // Hàm hiển thị/ẩn các bước
        function showStep(stepId) {
            const allSteps = [initialStateDiv, captchaContainer, waitingContainer, discordContainer, finalKeyContainer];
            allSteps.forEach(step => {
                if (step.id === stepId) {
                    step.style.display = 'block';
                } else {
                    step.style.display = 'none';
                }
            });
            globalMessage.textContent = ''; // Xóa thông báo chung mỗi khi đổi bước
        }

        // Bước 1: Bắt đầu lấy Key
        startButton.addEventListener('click', () => {
            showStep('captchaContainer');
            generateCaptcha();
            captchaInput.focus();
            captchaMessage.textContent = 'Tính toán cho kỹ nha bro!';
            captchaMessage.className = 'info';
        });

        // Hàm tạo Captcha đơn giản
        function generateCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1; // Số từ 1 đến 10
            const num2 = Math.floor(Math.random() * 10) + 1;
            captchaAnswer = num1 + num2;
            captchaQuestion.textContent = `HaiGPT đố bro: ${num1} + ${num2} = ?`;
            captchaInput.value = ''; // Xóa input cũ
        }

        // Bước 2: Xử lý Captcha
        submitCaptchaButton.addEventListener('click', () => {
            const userAnswer = parseInt(captchaInput.value.trim());
            if (isNaN(userAnswer) || userAnswer !== captchaAnswer) {
                captchaMessage.textContent = 'Sai rồi bro, tính toán lại coi =))';
                captchaMessage.className = 'error';
                generateCaptcha(); // Tạo captcha mới
            } else {
                captchaMessage.textContent = 'Chính xác! Bro thông minh đó =))';
                captchaMessage.className = 'success';
                setTimeout(() => startWaiting(), 1000); // Đợi 1 giây rồi chuyển bước
            }
        });

        // Bước 3: Đợi 10 giây và tải Key
        async function startWaiting() {
            showStep('waitingContainer');
            let countdown = 10;
            waitMessage.innerHTML = `<span class="spinner"></span> Đang chờ ${countdown} giây thần thánh để tải key từ vũ trụ GitHub...`;
            waitMessage.className = 'warning';

            // Bắt đầu tải key ngay lập tức trong khi chờ
            const fetchPromise = fetchKeys();

            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown >= 0) {
                    waitMessage.innerHTML = `<span class="spinner"></span> Đang chờ ${countdown} giây thần thánh để tải key từ vũ trụ GitHub...`;
                }
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    waitMessage.innerHTML = `<span class="spinner"></span> Đã xong 10 giây! Chuẩn bị chuyển bước...`;
                    fetchPromise.then(() => {
                        setTimeout(() => showDiscordButton(), 1000); // Đợi thêm 1 giây cho mượt
                    }).catch(error => {
                        globalMessage.textContent = `Ối giời ơi, lỗi khi tải key rồi: ${error.message}. Kêu TuanHaiDz sửa gấp đi!`;
                        globalMessage.className = 'error';
                        showStep('initialState'); // Quay về bước đầu
                        stepMessage.textContent = 'Lỗi tải key! Ấn lại để thử nha bro.';
                        stepMessage.className = 'error';
                    });
                }
            }, 1000);
        }

        async function fetchKeys() {
            try {
                const response = await fetch(KEY_SOURCE_URL);
                if (!response.ok) {
                    throw new Error(`Méo tải được keys: ${response.statusText}`);
                }
                const rawText = await response.text();
                validKeys = rawText.split('\n').map(key => key.trim()).filter(key => key.length > 0);
                if (validKeys.length > 0) {
                    finalKeyToDisplay = validKeys[0]; // Lấy key đầu tiên trong danh sách để hiển thị
                } else {
                    throw new Error("Không có key nào trong file! Check lại file đi bro.");
                }
                console.log("Keys đã tải xong:", validKeys); // Cho bro debug nếu cần
            } catch (error) {
                console.error('Lỗi thần thánh khi tải keys:', error);
                throw error; // Ném lỗi để promise chain bắt được
            }
        }

        // Bước 4: Hiển thị nút Discord
        function showDiscordButton() {
            showStep('discordContainer');
            discordMessage.textContent = 'Ấn nút "Tham gia Discord" rồi xác nhận để lấy key nha bro!';
            discordMessage.className = 'info';
            getKeyButton.disabled = false;
        }

        // Bước 5: Hiển thị Key khi xác nhận Discord
        getKeyButton.addEventListener('click', () => {
            if (finalKeyToDisplay) {
                showStep('finalKeyContainer');
                finalKeyDisplay.value = finalKeyToDisplay;
                finalKeyMessage.textContent = 'Đây là key của bro! Sao chép lẹ đi rồi quẩy =))';
                finalKeyMessage.className = 'success';
                finalKeyDisplay.select(); // Tự động chọn text để dễ copy
                finalKeyDisplay.setSelectionRange(0, 99999); // Dành cho di động
            } else {
                globalMessage.textContent = 'Ối, chưa có key để hiển thị! Có lỗi gì đó rồi bro.';
                globalMessage.className = 'error';
                showStep('initialState'); // Quay về bước đầu
            }
        });

        // Hàm copy key vào clipboard
        copyKeyButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(finalKeyDisplay.value);
                finalKeyMessage.textContent = 'Đã sao chép key vào clipboard! Nhanh gọn lẹ =))';
                finalKeyMessage.className = 'success';
            } catch (err) {
                console.error('Lỗi khi sao chép:', err);
                finalKeyMessage.textContent = 'Sao chép thất bại rồi bro ơi! Bro tự copy tay đi =))';
                finalKeyMessage.className = 'error';
            }
        });

        // Khởi tạo trạng thái ban đầu khi load trang
        showStep('initialState');
    </script>
</body>
</html>
